---
// src/layouts/Base.astro
const { title = 'AlertsAnalytics', description = '', canonical = '' } = Astro.props;
const GA_ID = import.meta.env.PUBLIC_GA4_ID;
const GTM_ID = import.meta.env.PUBLIC_GTM_ID;
const ADS_PUB = import.meta.env.PUBLIC_ADSENSE_PUB_ID;
const GADS_ID = import.meta.env.PUBLIC_GOOGLE_ADS_ID; // e.g. AW-XXXXXXXXXXXX
const FIRST_TAG_ID = GA_ID || GADS_ID;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    {description && <meta name="description" content={description} />}
    {canonical && <link rel="canonical" href={canonical} />}
    <style>
      :root { --fg:#111827; --muted:#6b7280; --link:#1d4ed8; }
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; color: var(--fg); margin: 0; }
      header, footer { padding: 12px 16px; border-bottom: 1px solid #e5e7eb; }
      footer { border-top: 1px solid #e5e7eb; border-bottom: none; color: var(--muted); font-size: 0.9rem; }
      main { padding: 16px; max-width: 900px; margin: 0 auto; }
      nav a { margin-right: 12px; color: var(--link); text-decoration: none; }
      nav a:hover { text-decoration: underline; }
    </style>

    {
      /* Prefer GTM if provided */
      GTM_ID ? (
        <script>
          {`(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
          var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
          j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','${GTM_ID}');`}
        </script>
      ) : FIRST_TAG_ID ? (
        <>
          <script async src={`https://www.googletagmanager.com/gtag/js?id=${FIRST_TAG_ID}`}></script>
          <script>
            {`window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date());`}
          </script>
          {GA_ID && (
            <script>
              {`gtag('config', '${GA_ID}');`}
            </script>
          )}
          {GADS_ID && (
            <script>
              {`gtag('config', '${GADS_ID}');`}
            </script>
          )}
        </>
      ) : null
    }

    {ADS_PUB && (
      <script async src={`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-${ADS_PUB}`} crossorigin="anonymous"></script>
    )}
  </head>
  <body>
    <header>
      <nav>
        <a href="/">Home</a>
        <a href="/about">About</a>
        <a href="/contact">Contact</a>
        <a href="/privacy">Privacy</a>
      </nav>
    </header>

    <main>
      <slot />
    </main>

    <footer>
      <div>© {new Date().getFullYear()} AlertsAnalytics — Real-time public safety monitoring. Independent data analysis, not affiliated with any government agency.</div>
    </footer>
  </body>
</html>
